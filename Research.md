# 研究日誌  

## 5月8日  
##  問題1  
- ファイル編集履歴をcronを使って5分ごとに実行していることにより, 収集したログから分析できない可能性 

## 解決方法1
- cronによって実行しているスクリプトの実行間隔を5分ごとから1分ごとに変更する.


## 5月14日-15日  
## 実作業
- cronによって実行しているスクリプトの実行間隔を5分ごとから1分ごとに変更するファイルを配置する.また、現在のcronに登録している時間を削除する.  
- ファイル編集履歴を収集しているシェルスクリプトを書き換える. git pushを行う前にgit pullを行う.  
- サーバは2週間に一回リセットされるため,上記で変更した場所を反映させるためのupdata.shを作成して2週間に一回実行する.

## 5月20日
## 実作業
- lsyncの使い方など一通りを調べた．また,テスト用の環境にインストールを行なった．

## 5月21日  
## 問題1  
- ファイル編集履歴が閲覧できなくなってしまった．原因はgitのpush間隔を5分から30秒に変更したためと考える.  

## 解決方法1  
- cronによって定期的にファイル編集履歴を収集するのではなく，lsyncを利用してinotifyによってファイル変更を検知した時だけgit commitを行いpushするように変更すること

## 解決方法2
- 現時点で解決方法1が完成していないため，cronの間隔を元に戻すことで一時的に対応する．

## 5月22日  
## 実作業  
- lsyncの利用方法の調査，(試したがうまくいかない)  
- push はしておく (するのを忘れた)
- サーバは2週間に一回リセットされるため,上記で変更した場所を反映させるためのupdata.shを作成して2週間に一回実行する. (作成途中)

## 学会について
- ソフトウェアシンポジウム2018にポスター発表を行う予定
- 展示時間はおよそ1時間
- 学会ポスター〆切 7月27日

## 論文を書くまでの理想
- 可視化まで完成するのが理想的
- ログデータを参照していく中でエラーが発生した事例をあげるなど
- データベースで確認するレベルでとりあえずよい
- 質問に対応したログがあるか確認できればなお良い  

## 5月24日
- 中間発表に向けてのタイトルを考えた．

## 5月28/29日
- M1中間発表にむけてのプレゼン資料作り

## 6月5日
- lsyncdの使い方調査中 正直よくわからん...

## lsyncdが動作しない原因を特定
- lsyncdは裏ではrsyncを利用する．そのため，ファイルを同期する際rsyncがパスワードを訪ねてくる．そのパスワード入力がタイムアウトしてたっぽい．
- パスワードを聞いて来ないように設定するためには，~/.sshに公開鍵を正しくセットする．

## 見つけるのに時間がかかった要因
- serviceに登録してデーモンとして実行していたためパスワード要求がバックグラウンドで実行される． 
- デーモンモードを解除するには/etc/lsyncd.confのnodaemonをtrueに変更する．  
- フォアグラウンドでは、パスワード要求がないため裏で勝手にタイムアウトして、lsyncdのデーモンが動作していなかった．  
- こういうソフトを動かす時はまずデーモン化させずに実行して，そのあとバックグラウンド実行した方がいいかな．当たり前か．

## 実作業
- lsyncdの設定ファイルを編集した．監視対象は/etcのみ.
- 監視ディレクトリを/etcと/varに拡張設定した．
- lsyncdをserviceに登録してデーモン化して，バックグラウンド実行させた．
- pipのインストール
- pyinotifyのインストール

## README.mdの編集
- 今までの作業分を更新  

## 6月6日
- pyinotifyのサンプルコードの動作確認

## 6月7日

## 問題
- GitPythonがpython2.6.6では動かないことがわかった．

## 解決方法
- python2.7.13をCentOS6.7に追加インストールを行なった．

## 実作業
- pythonでgitコマンドを実行したい
- GitPythonをpipでインストールした．
- python2.6.6では，GitPythonが動作しないことが判明した．
- 動作しなかったため，テスト環境にpython2.7.13を再インストール
- python2.7.13をインストールするとpip8.1.2も自動でインストールされる
- pip8.1.2でpymongo,pyinotify,GitPythonをインストールし直した
- Readmeのソフトのインストールや使い方の部分をノウハウのマークダウンに分けた．

## 6月11日

## 実作業
- gitbucketの修理(といいつつデータは悲しかな消してしまった...)
- gitbucketを最初から作り直した．
- pyinotifyとgitpythonを組み合わせているところ

## 作業メモ　newファイル編集履歴
- 実行したい順番
1. リモートリポジトリをcloneする．
2. lsyncdによりディレクトリの同期(バックグラウンド実行により変更があるたびファイルを同期)
3. 同期したディレクトリをgit add/commitする
4. pyinotifyにより監視ディレクトリ以下の変更が検知されたら，git add/commitする

最初に同期を行うためにはlsyncdをrestartする必要がある


## 6月12日

## 実作業
- supervisorの使い方調査
- 自動的にcommitするスクリプトの修正

## 問題点
- 自動commitするスクリプトを実行すると.swpファイルがgitに検知される
- .swpファイルを検知しないようにgitignoreに記述する(おそらく)

## 6月18日

## 実作業
- lsyncdのみでファイル編集履歴を収集できるように方向転換
- lsyncd.confファイルを書き換え，ファイルの追加・変更・削除を検知したらリポジトリにgit commitを行う用に書き換えた．

## 6月25日

## 実作業
- 20台分のファイル編集履歴の設定を行った．

## 来週までのタスク
- ログから学生の状況を確認
- 可視化を行うためにFlaskを利用

可視化した
事例を挙げる
行き詰まってた事例

事例を先に見つけて
それに適した可視化方法の提案

いつまで動かすことができるのか聞いておく
